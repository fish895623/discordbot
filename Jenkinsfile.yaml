pipeline:
  agent:
    docker:
      image: "fish895623/ddocker:latest"
      args: '-v /var/run/docker.sock:/var/run/docker.sock'
  stages:
    - stage: "Parrallel Test"
      parallel:
        - stage: "build-test-1"
          steps:
            - sh "echo 1"
        - stage: "build-test-2"
          steps:
            - sh "echo 1"
        - stage: "build-test-3"
          steps:
            - sh "echo 1"
    - stage: "build Docker"
      steps:
        script:
          - checkout scm
          - def customImage = docker.build("my-image:${env.BUILD_ID}")
          - customImage.inside:
            - sh 'make test'
